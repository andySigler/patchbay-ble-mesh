{"ast":null,"code":"import * as utils from './DrawUtils';\nimport { AppParams } from './AppParams';\nimport { Connection } from './Connection';\nimport { Finger } from './Finger';\nimport { Circle } from './Circle';\nconst userEventTypes = {\n  touch: 'touch',\n  move: 'move',\n  release: 'release'\n};\nconst patchbayDefaults = {\n  tempThickness: 0.1,\n  screenPercentage: 0.25,\n  touchCircleThicknessScaler: 0.1,\n  touchedLineMaxWidth: 4,\n  touchedLineMinWidth: 2,\n  touchedTipPreScaler: 1.25,\n  touchedTipPostScaler: 0.1,\n  hoveredCircleWidthScaler: 0.1\n};\n\nclass Patchbay {\n  constructor(canvas) {\n    this.params = new AppParams(canvas.getContext('2d'));\n    this.params.inCircle = new Circle(this.params, this.params.inType, patchbayDefaults.screenPercentage, patchbayDefaults.tempThickness);\n    this.params.outCircle = new Circle(this.params, this.params.outType, patchbayDefaults.screenPercentage, patchbayDefaults.tempThickness);\n    this.finger = new Finger(this.params, (outID, outIndex, inID, inIndex) => {\n      const name = Connection.generateName(outID, outIndex, inID, inIndex);\n      this.createConnection(outID, outIndex, inID, inIndex);\n    }, (outID, outIndex, inID, inIndex) => {\n      const name = Connection.generateName(outID, outIndex, inID, inIndex);\n      console.log('call to delete connection: ' + name);\n    });\n    this.reqAnimFrame = undefined;\n  }\n\n  drawLoop() {\n    if (this.reqAnimFrame) {\n      cancelAnimationFrame(this.reqAnimFrame);\n      this.reqAnimFrame = undefined;\n    }\n\n    this.finger.update();\n    this.params.outCircle.update();\n    this.params.inCircle.update();\n\n    for (let i in this.params.connections) {\n      this.params.connections[i].update();\n    }\n\n    this.params.context.save();\n    this.clearCanvas();\n    this.params.outCircle.drawArcs();\n    this.params.inCircle.drawArcs();\n    this.params.outCircle.drawNames();\n    this.params.inCircle.drawNames();\n    this.params.outCircle.drawPorts();\n    this.params.inCircle.drawPorts();\n\n    for (let i in this.params.connections) {\n      this.params.connections[i].draw();\n    }\n\n    this.drawTouchedPort();\n    this.drawHoveredPort();\n    this.params.context.restore();\n    this.reqAnimFrame = requestAnimationFrame(() => this.drawLoop());\n  }\n\n  drawTouchedPort() {\n    if (!this.params.touchedPort) {\n      return;\n    }\n\n    const touchCircleThickness = this.params.touchedPort.size * patchbayDefaults.touchCircleThicknessScaler;\n    let touchedLineWidth = Math.sin(this.params.touchedPort.wobbleCounter);\n    touchedLineWidth = (touchedLineWidth + 1) / 2; // map to 0-1\n\n    touchedLineWidth *= patchbayDefaults.touchedLineMaxWidth - patchbayDefaults.touchedLineMinWidth;\n    touchedLineWidth += patchbayDefaults.touchedLineMinWidth;\n    let touchedLineTipCircleScaler = this.params.touchedPort.scaler;\n    touchedLineTipCircleScaler *= patchbayDefaults.touchedTipPreScaler;\n    touchedLineTipCircleScaler = Math.min(touchedLineTipCircleScaler, 1);\n    touchedLineTipCircleScaler = Math.max(touchedLineTipCircleScaler, 0);\n    touchedLineTipCircleScaler *= patchbayDefaults.touchedTipPostScaler;\n    const circleRadius = this.params.touchedPort.size * touchedLineTipCircleScaler; // draw the outlining circle\n\n    this.params.context.save();\n    utils.drawArc(this.params.context, this.params.touchedPort.x, this.params.touchedPort.y, this.params.touchedPort.size, 0, utils.PI2, touchCircleThickness, utils.colors.white(), undefined);\n    this.params.context.restore(); // then draw the line, that wobbles its thickness\n\n    this.params.context.save();\n    utils.drawLine(this.params.context, this.params.touchedPort.x, this.params.touchedPort.y, this.finger.x, this.finger.y, touchedLineWidth, utils.colors.green());\n    this.params.context.restore(); // then two smaller filled in circles to cover the tips of the line\n\n    this.params.context.save();\n    utils.drawArc(this.params.context, this.params.touchedPort.x, this.params.touchedPort.y, circleRadius, 0, utils.PI2, 0, undefined, utils.colors.white());\n    utils.drawArc(this.params.context, this.finger.x, this.finger.y, circleRadius, 0, utils.PI2, 0, undefined, utils.colors.white());\n    this.params.context.restore();\n  }\n\n  drawHoveredPort() {\n    if (!this.params.hoveredPort) {\n      return;\n    }\n\n    const hoveredCircleWidth = this.params.hoveredPort.size * patchbayDefaults.hoveredCircleWidthScaler;\n    this.params.context.save();\n    utils.drawArc(this.params.context, this.params.hoveredPort.x, this.params.hoveredPort.y, this.params.hoveredPort.size, 0, utils.PI2, hoveredCircleWidth, utils.colors.green(), undefined);\n    this.params.context.restore();\n  }\n\n  setSize(width, height) {\n    this.params.width = width;\n    this.params.height = height;\n  }\n\n  clearCanvas() {\n    this.params.context.fillStyle = utils.colors.background();\n    this.params.context.fillRect(0, 0, this.params.width, this.params.height);\n  }\n\n  createConnection(outputID, outputIndex, inputID, inputIndex) {\n    const tempName = Connection.generateName(outputID, outputIndex, inputID, inputIndex);\n\n    if (!this.params.connections[tempName]) {\n      let outPort = this.params.getPort(outputID, outputIndex, this.params.outType);\n      let inPort = this.params.getPort(inputID, inputIndex, this.params.inType);\n\n      if (outPort && inPort) {\n        const newConnection = new Connection(this.params, outPort, inPort, tempName);\n        this.params.addConnection(tempName, newConnection);\n      }\n    } else {\n      // TODO: not sure what this does, seems to be left over from thesis\n      this.params.connections[tempName].exists = true;\n    }\n\n    return tempName;\n  }\n\n  deleteConnection(outputID, outputIndex, inputID, inputIndex) {\n    const name = Connection.generateName(outID, outIndex, inID, inIndex);\n    this.params.deleteConnection(name);\n  }\n\n  eraseNodeFromConnections(id) {\n    for (let n in this.params.connections) {\n      const conn = this.params.connections[n];\n\n      if (conn.outPort.parent.id === id || conn.inPort.parent.id === id) {\n        this.params.deleteConnection(n);\n      }\n    }\n  }\n\n  handleUserEvent(type, x, y) {\n    if (type === userEventTypes.touch) {\n      const justTouched = true;\n      this.finger.moveEvent(x, y, justTouched);\n      this.finger.touchEvent();\n    } else if (type === userEventTypes.move) {\n      const justTouched = false;\n      this.finger.moveEvent(x, y, justTouched);\n    } else if (type === userEventTypes.release) {\n      this.finger.releaseEvent(x, y);\n    }\n  }\n\n}\n\nexport { Patchbay, userEventTypes };","map":{"version":3,"sources":["/Users/andy/Documents/patchbay-react/patchbay-react/src/modules/Patchbay.js"],"names":["utils","AppParams","Connection","Finger","Circle","userEventTypes","touch","move","release","patchbayDefaults","tempThickness","screenPercentage","touchCircleThicknessScaler","touchedLineMaxWidth","touchedLineMinWidth","touchedTipPreScaler","touchedTipPostScaler","hoveredCircleWidthScaler","Patchbay","constructor","canvas","params","getContext","inCircle","inType","outCircle","outType","finger","outID","outIndex","inID","inIndex","name","generateName","createConnection","console","log","reqAnimFrame","undefined","drawLoop","cancelAnimationFrame","update","i","connections","context","save","clearCanvas","drawArcs","drawNames","drawPorts","draw","drawTouchedPort","drawHoveredPort","restore","requestAnimationFrame","touchedPort","touchCircleThickness","size","touchedLineWidth","Math","sin","wobbleCounter","touchedLineTipCircleScaler","scaler","min","max","circleRadius","drawArc","x","y","PI2","colors","white","drawLine","green","hoveredPort","hoveredCircleWidth","setSize","width","height","fillStyle","background","fillRect","outputID","outputIndex","inputID","inputIndex","tempName","outPort","getPort","inPort","newConnection","addConnection","exists","deleteConnection","eraseNodeFromConnections","id","n","conn","parent","handleUserEvent","type","justTouched","moveEvent","touchEvent","releaseEvent"],"mappings":"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","sourcesContent":["import * as utils from './DrawUtils'\nimport { AppParams } from './AppParams'\nimport { Connection } from './Connection'\nimport { Finger } from './Finger'\nimport { Circle } from './Circle'\n\n\nconst userEventTypes = {\n  touch: 'touch',\n  move: 'move',\n  release: 'release'\n};\n\n\nconst patchbayDefaults = {\n  tempThickness: 0.1,\n  screenPercentage: 0.25,\n  touchCircleThicknessScaler: 0.1,\n  touchedLineMaxWidth: 4,\n  touchedLineMinWidth: 2,\n  touchedTipPreScaler: 1.25,\n  touchedTipPostScaler: 0.1,\n  hoveredCircleWidthScaler: 0.1\n};\n\nclass Patchbay {\n  constructor (canvas) {\n    this.params = new AppParams(canvas.getContext('2d'));\n    this.params.inCircle = new Circle(\n      this.params,\n      this.params.inType,\n      patchbayDefaults.screenPercentage,\n      patchbayDefaults.tempThickness\n    );\n    this.params.outCircle = new Circle(\n      this.params,\n      this.params.outType,\n      patchbayDefaults.screenPercentage,\n      patchbayDefaults.tempThickness\n    );\n    this.finger = new Finger(\n      this.params,\n      (outID, outIndex, inID, inIndex) => {\n        const name = Connection.generateName(outID, outIndex, inID, inIndex);\n        this.createConnection(outID, outIndex, inID, inIndex)\n      },\n      (outID, outIndex, inID, inIndex) => {\n        const name = Connection.generateName(outID, outIndex, inID, inIndex);\n        console.log('call to delete connection: ' + name)\n      }\n    );\n    this.reqAnimFrame = undefined;\n  }\n\n  drawLoop () {\n    if (this.reqAnimFrame) {\n      cancelAnimationFrame(this.reqAnimFrame);\n      this.reqAnimFrame = undefined;\n    }\n    this.finger.update();\n    this.params.outCircle.update();\n    this.params.inCircle.update();\n    for(let i in this.params.connections){\n      this.params.connections[i].update();\n    }\n\n    this.params.context.save();\n    this.clearCanvas();\n\n    this.params.outCircle.drawArcs();\n    this.params.inCircle.drawArcs();\n\n    this.params.outCircle.drawNames();\n    this.params.inCircle.drawNames();\n\n    this.params.outCircle.drawPorts();\n    this.params.inCircle.drawPorts();\n\n    for(let i in this.params.connections){\n      this.params.connections[i].draw();\n    }\n\n    this.drawTouchedPort();\n    this.drawHoveredPort();\n\n    this.params.context.restore();\n    this.reqAnimFrame = requestAnimationFrame(() => this.drawLoop());\n  }\n\n  drawTouchedPort () {\n    if (!this.params.touchedPort) {\n      return;\n    }\n\n    const touchCircleThickness = this.params.touchedPort.size * patchbayDefaults.touchCircleThicknessScaler;\n    let touchedLineWidth = Math.sin(this.params.touchedPort.wobbleCounter);\n    touchedLineWidth = (touchedLineWidth + 1) / 2; // map to 0-1\n    touchedLineWidth *= patchbayDefaults.touchedLineMaxWidth - patchbayDefaults.touchedLineMinWidth;\n    touchedLineWidth += patchbayDefaults.touchedLineMinWidth;\n    let touchedLineTipCircleScaler = this.params.touchedPort.scaler;\n    touchedLineTipCircleScaler *= patchbayDefaults.touchedTipPreScaler;\n    touchedLineTipCircleScaler = Math.min(touchedLineTipCircleScaler, 1);\n    touchedLineTipCircleScaler = Math.max(touchedLineTipCircleScaler, 0);\n    touchedLineTipCircleScaler *= patchbayDefaults.touchedTipPostScaler;\n    const circleRadius = this.params.touchedPort.size * touchedLineTipCircleScaler;\n\n    // draw the outlining circle\n    this.params.context.save();\n    utils.drawArc(\n      this.params.context,\n      this.params.touchedPort.x, this.params.touchedPort.y,\n      this.params.touchedPort.size, 0, utils.PI2, touchCircleThickness,\n      utils.colors.white(), undefined\n    );\n    this.params.context.restore();\n\n    // then draw the line, that wobbles its thickness\n    this.params.context.save();\n    utils.drawLine(\n      this.params.context,\n      this.params.touchedPort.x, this.params.touchedPort.y,\n      this.finger.x, this.finger.y,\n      touchedLineWidth, utils.colors.green()\n    );\n    this.params.context.restore();\n\n    // then two smaller filled in circles to cover the tips of the line\n    this.params.context.save();\n    utils.drawArc(\n      this.params.context,\n      this.params.touchedPort.x, this.params.touchedPort.y,\n      circleRadius, 0, utils.PI2, 0,\n      undefined, utils.colors.white()\n    );\n    utils.drawArc(\n      this.params.context,\n      this.finger.x, this.finger.y,\n      circleRadius, 0, utils.PI2, 0,\n      undefined, utils.colors.white()\n    );\n    this.params.context.restore();\n  }\n\n  drawHoveredPort () {\n    if (!this.params.hoveredPort) {\n      return;\n    }\n    const hoveredCircleWidth = this.params.hoveredPort.size * patchbayDefaults.hoveredCircleWidthScaler;\n    this.params.context.save();\n    utils.drawArc(\n      this.params.context,\n      this.params.hoveredPort.x, this.params.hoveredPort.y,\n      this.params.hoveredPort.size, 0, utils.PI2, hoveredCircleWidth,\n      utils.colors.green(), undefined\n    );\n    this.params.context.restore();\n  }\n\n  setSize (width, height) {\n    this.params.width = width;\n    this.params.height = height;\n  }\n\n  clearCanvas() {\n    this.params.context.fillStyle = utils.colors.background();\n    this.params.context.fillRect(0, 0, this.params.width, this.params.height);\n  }\n\n  createConnection (outputID, outputIndex, inputID, inputIndex) {\n    const tempName = Connection.generateName(outputID, outputIndex, inputID, inputIndex);\n    if (!this.params.connections[tempName]) {\n      let outPort = this.params.getPort(outputID, outputIndex, this.params.outType);\n      let inPort = this.params.getPort(inputID, inputIndex, this.params.inType);\n      if (outPort && inPort) {\n        const newConnection = new Connection(this.params, outPort, inPort, tempName);\n        this.params.addConnection(tempName, newConnection);\n      }\n    }\n    else {\n      // TODO: not sure what this does, seems to be left over from thesis\n      this.params.connections[tempName].exists = true;\n    }\n    return tempName;\n  }\n\n  deleteConnection (outputID, outputIndex, inputID, inputIndex) {\n    const name = Connection.generateName(outID, outIndex, inID, inIndex);\n    this.params.deleteConnection(name);\n  }\n\n  eraseNodeFromConnections (id) {\n    for (let n in this.params.connections) {\n      const conn = this.params.connections[n];\n      if (conn.outPort.parent.id === id || conn.inPort.parent.id === id) {\n        this.params.deleteConnection(n);\n      }\n    }\n  }\n\n  handleUserEvent (type, x, y) {\n    if (type === userEventTypes.touch) {\n      const justTouched = true;\n      this.finger.moveEvent(x, y, justTouched);\n      this.finger.touchEvent();\n    }\n    else if (type === userEventTypes.move) {\n      const justTouched = false;\n      this.finger.moveEvent(x, y, justTouched);\n    }\n    else if (type === userEventTypes.release) {\n      this.finger.releaseEvent(x, y);\n    }\n  }\n}\n\nexport { Patchbay, userEventTypes }\n"]},"metadata":{},"sourceType":"module"}