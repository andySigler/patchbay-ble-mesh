{"ast":null,"code":"import * as utils from './PatchbayUtils';\nconst portDefaults = {\n  wobbleStep: 0.07,\n  wobbleScaler: 0.1,\n  lineWidthScaler: 0.4,\n  minSizeScaler: 0.25,\n  // percentage\n  fillTextFontSizeScaler: 0.2,\n  fontSizeScaler: 0.4\n};\n\nclass Port {\n  constructor(context, parent, type, id, name, color, getGlobalTouchedPort, getGlobalHoveredPort) {\n    this.context = context;\n    this._parent = parent;\n    this._type = type;\n    this._id = id;\n    this._name = name;\n    this.getGlobalTouchedPort = getGlobalTouchedPort;\n    this.getGlobalHoveredPort = getGlobalHoveredPort;\n    this.connections = {};\n    this._x = 0;\n    this._y = 0;\n    this.textOffset = undefined;\n    this._visible = false;\n    this._sizeScaler = 0.0;\n    this.parentX = 0;\n    this.parentY = 0;\n    this.parentRadius = undefined;\n    this.parentWidth = undefined;\n    this.wobbleCounter = Math.random() * utils.PI2;\n    this.portRadius = undefined;\n    this.drawnPortRadius = undefined;\n    this.lineWidth = undefined;\n    this.strokeStyle = utils.colors.background();\n    this.fillStyle = color();\n    this.highlightedFillStyle = utils.colors.white();\n  } // GETTERS\n\n\n  get visible() {\n    return this._visible;\n  }\n\n  get x() {\n    return this._x;\n  }\n\n  get y() {\n    return this._y;\n  }\n\n  get name() {\n    return this._name;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get type() {\n    return this._type;\n  }\n\n  get parent() {\n    return this._parent;\n  }\n\n  get radius() {\n    return this.portRadius;\n  }\n\n  get sizeScaler() {\n    return this._sizeScaler;\n  } // SETTERS\n\n\n  set name(name) {\n    this._name = name;\n  }\n\n  isTouched() {\n    return Boolean(this.getGlobalTouchedPort() === this);\n  }\n\n  isPotentialConnection() {\n    const port = this.getGlobalTouchedPort();\n    return Boolean(port && port.type !== this._type);\n  }\n\n  isHovered() {\n    return Boolean(this.getGlobalHoveredPort() === this);\n  }\n\n  adjustToScreenSize(parentRadius, parentWidth, parentX, parentY) {\n    this.parentRadius = parentRadius;\n    this.parentWidth = parentWidth;\n    this.parentX = parentX;\n    this.parentY = parentY;\n  }\n\n  update(sizeScaler, radLocation, isVisible) {\n    // the Port is only visible if 1) told so by parent, and 2) is big enough\n    this._visible = isVisible && sizeScaler > portDefaults.minSizeScaler;\n    this._sizeScaler = !this._visible ? 0 : sizeScaler; // Ports need an absolute coordinate on the screen\n    // because their position is used to determine when they are being\n    // interacted with\n\n    this._x = this.parentRadius * Math.cos(radLocation) + this.parentX;\n    this._y = this.parentRadius * Math.sin(radLocation) + this.parentY; // drawArc() radius and stroke width\n\n    this.lineWidth = Math.floor(this.portRadius * portDefaults.lineWidthScaler);\n    this.portRadius = this.parentWidth / 2 * this._sizeScaler;\n    this.drawnPortRadius = Number(this.portRadius); // wobble the port's radius, if `touchedPort` is from the other circle\n\n    if (this.isPotentialConnection()) {\n      this.wobbleCounter = (this.wobbleCounter + portDefaults.wobbleStep) % utils.PI2;\n      const wobbleMaxSize = portDefaults.wobbleScaler * this.portRadius;\n      this.drawnPortRadius += Math.sin(this.wobbleCounter) * wobbleMaxSize;\n    } // text settings\n\n\n    this.textOffset = this.parentRadius - this.parentWidth / 2 - this.lineWidth;\n    this.fontSize = this._sizeScaler * this.parentWidth * portDefaults.fontSizeScaler;\n  }\n\n  draw() {\n    ;\n\n    if (this._visible) {\n      this.context.save();\n      utils.drawCircle(this.context, 0, this.parentRadius, this.drawnPortRadius, this.lineWidth, this.strokeStyle, this.fillStyle);\n      this.context.restore();\n    }\n  }\n\n  drawName() {\n    this.context.save();\n    this.context.translate(this.textOffset, 0);\n\n    if (this._x < this.parentX) {\n      this.context.textAlign = 'left';\n      this.context.rotate(utils.PI);\n    } else {\n      this.context.textAlign = 'right';\n    }\n\n    this.context.font = utils.font(this.fontSize);\n\n    if (this.isTouched() || this.isHovered()) {\n      this.context.fillStyle = this.highlightedFillStyle;\n    } else {\n      this.context.fillStyle = this.fillStyle;\n    }\n\n    this.context.fillText(this._name, 0, this.fontSize * portDefaults.fillTextFontSizeScaler);\n    this.context.restore();\n  }\n\n  isUserTouching(x, y) {\n    const dist = utils.getDistance(this._x, this._y, x, y);\n\n    if (this._visible && dist < this.portRadius) {\n      return true;\n    }\n\n    return false;\n  }\n\n}\n\nexport { Port };","map":{"version":3,"sources":["/Users/andy/Documents/patchbay-react/patchbay-react/src/modules/Port.js"],"names":["utils","portDefaults","wobbleStep","wobbleScaler","lineWidthScaler","minSizeScaler","fillTextFontSizeScaler","fontSizeScaler","Port","constructor","context","parent","type","id","name","color","getGlobalTouchedPort","getGlobalHoveredPort","_parent","_type","_id","_name","connections","_x","_y","textOffset","undefined","_visible","_sizeScaler","parentX","parentY","parentRadius","parentWidth","wobbleCounter","Math","random","PI2","portRadius","drawnPortRadius","lineWidth","strokeStyle","colors","background","fillStyle","highlightedFillStyle","white","visible","x","y","radius","sizeScaler","isTouched","Boolean","isPotentialConnection","port","isHovered","adjustToScreenSize","update","radLocation","isVisible","cos","sin","floor","Number","wobbleMaxSize","fontSize","draw","save","drawCircle","restore","drawName","translate","textAlign","rotate","PI","font","fillText","isUserTouching","dist","getDistance"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,iBAAvB;AAEA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,UAAU,EAAE,IADO;AAEnBC,EAAAA,YAAY,EAAE,GAFK;AAGnBC,EAAAA,eAAe,EAAE,GAHE;AAInBC,EAAAA,aAAa,EAAE,IAJI;AAIE;AACrBC,EAAAA,sBAAsB,EAAE,GALL;AAMnBC,EAAAA,cAAc,EAAE;AANG,CAArB;;AASA,MAAMC,IAAN,CAAW;AACTC,EAAAA,WAAW,CAAEC,OAAF,EAAWC,MAAX,EAAmBC,IAAnB,EAAyBC,EAAzB,EAA6BC,IAA7B,EAAmCC,KAAnC,EAA0CC,oBAA1C,EAAgEC,oBAAhE,EAAsF;AAC/F,SAAKP,OAAL,GAAeA,OAAf;AACA,SAAKQ,OAAL,GAAeP,MAAf;AACA,SAAKQ,KAAL,GAAaP,IAAb;AACA,SAAKQ,GAAL,GAAWP,EAAX;AACA,SAAKQ,KAAL,GAAaP,IAAb;AAEA,SAAKE,oBAAL,GAA4BA,oBAA5B;AACA,SAAKC,oBAAL,GAA4BA,oBAA5B;AAEA,SAAKK,WAAL,GAAmB,EAAnB;AAEA,SAAKC,EAAL,GAAU,CAAV;AACA,SAAKC,EAAL,GAAU,CAAV;AACA,SAAKC,UAAL,GAAkBC,SAAlB;AAEA,SAAKC,QAAL,GAAgB,KAAhB;AACA,SAAKC,WAAL,GAAmB,GAAnB;AAEA,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,YAAL,GAAoBL,SAApB;AACA,SAAKM,WAAL,GAAmBN,SAAnB;AAEA,SAAKO,aAAL,GAAqBC,IAAI,CAACC,MAAL,KAAgBnC,KAAK,CAACoC,GAA3C;AACA,SAAKC,UAAL,GAAkBX,SAAlB;AACA,SAAKY,eAAL,GAAuBZ,SAAvB;AACA,SAAKa,SAAL,GAAiBb,SAAjB;AAEA,SAAKc,WAAL,GAAmBxC,KAAK,CAACyC,MAAN,CAAaC,UAAb,EAAnB;AACA,SAAKC,SAAL,GAAiB5B,KAAK,EAAtB;AACA,SAAK6B,oBAAL,GAA4B5C,KAAK,CAACyC,MAAN,CAAaI,KAAb,EAA5B;AACD,GAjCQ,CAmCT;;;AAEA,MAAIC,OAAJ,GAAe;AAAE,WAAO,KAAKnB,QAAZ;AAAsB;;AAEvC,MAAIoB,CAAJ,GAAS;AAAE,WAAO,KAAKxB,EAAZ;AAAgB;;AAE3B,MAAIyB,CAAJ,GAAS;AAAE,WAAO,KAAKxB,EAAZ;AAAgB;;AAE3B,MAAIV,IAAJ,GAAY;AAAE,WAAO,KAAKO,KAAZ;AAAoB;;AAElC,MAAIR,EAAJ,GAAU;AAAE,WAAO,KAAKO,GAAZ;AAAkB;;AAE9B,MAAIR,IAAJ,GAAY;AAAE,WAAO,KAAKO,KAAZ;AAAoB;;AAElC,MAAIR,MAAJ,GAAc;AAAE,WAAO,KAAKO,OAAZ;AAAsB;;AAEtC,MAAI+B,MAAJ,GAAc;AAAE,WAAO,KAAKZ,UAAZ;AAAyB;;AAEzC,MAAIa,UAAJ,GAAkB;AAAE,WAAO,KAAKtB,WAAZ;AAA0B,GArDrC,CAuDT;;;AAEA,MAAId,IAAJ,CAAUA,IAAV,EAAgB;AAAE,SAAKO,KAAL,GAAaP,IAAb;AAAoB;;AAEtCqC,EAAAA,SAAS,GAAI;AACX,WAAOC,OAAO,CAAC,KAAKpC,oBAAL,OAAgC,IAAjC,CAAd;AACD;;AAEDqC,EAAAA,qBAAqB,GAAI;AACvB,UAAMC,IAAI,GAAG,KAAKtC,oBAAL,EAAb;AACA,WAAOoC,OAAO,CAACE,IAAI,IAAIA,IAAI,CAAC1C,IAAL,KAAc,KAAKO,KAA5B,CAAd;AACD;;AAEDoC,EAAAA,SAAS,GAAI;AACX,WAAOH,OAAO,CAAC,KAAKnC,oBAAL,OAAgC,IAAjC,CAAd;AACD;;AAEDuC,EAAAA,kBAAkB,CAAEzB,YAAF,EAAgBC,WAAhB,EAA6BH,OAA7B,EAAsCC,OAAtC,EAA+C;AAC/D,SAAKC,YAAL,GAAoBA,YAApB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKH,OAAL,GAAeA,OAAf;AACA,SAAKC,OAAL,GAAeA,OAAf;AACD;;AAED2B,EAAAA,MAAM,CAAEP,UAAF,EAAcQ,WAAd,EAA2BC,SAA3B,EAAsC;AAC1C;AACA,SAAKhC,QAAL,GAAgBgC,SAAS,IAAIT,UAAU,GAAGjD,YAAY,CAACI,aAAvD;AACA,SAAKuB,WAAL,GAAmB,CAAC,KAAKD,QAAN,GAAiB,CAAjB,GAAqBuB,UAAxC,CAH0C,CAI1C;AACA;AACA;;AACA,SAAK3B,EAAL,GAAU,KAAKQ,YAAL,GAAoBG,IAAI,CAAC0B,GAAL,CAASF,WAAT,CAApB,GAA4C,KAAK7B,OAA3D;AACA,SAAKL,EAAL,GAAU,KAAKO,YAAL,GAAoBG,IAAI,CAAC2B,GAAL,CAASH,WAAT,CAApB,GAA4C,KAAK5B,OAA3D,CAR0C,CAS1C;;AACA,SAAKS,SAAL,GAAiBL,IAAI,CAAC4B,KAAL,CAAW,KAAKzB,UAAL,GAAkBpC,YAAY,CAACG,eAA1C,CAAjB;AACA,SAAKiC,UAAL,GAAmB,KAAKL,WAAL,GAAmB,CAApB,GAAyB,KAAKJ,WAAhD;AACA,SAAKU,eAAL,GAAuByB,MAAM,CAAC,KAAK1B,UAAN,CAA7B,CAZ0C,CAa1C;;AACA,QAAG,KAAKgB,qBAAL,EAAH,EAAiC;AAC/B,WAAKpB,aAAL,GAAqB,CAAC,KAAKA,aAAL,GAAqBhC,YAAY,CAACC,UAAnC,IAAiDF,KAAK,CAACoC,GAA5E;AACA,YAAM4B,aAAa,GAAG/D,YAAY,CAACE,YAAb,GAA4B,KAAKkC,UAAvD;AACA,WAAKC,eAAL,IAAwBJ,IAAI,CAAC2B,GAAL,CAAS,KAAK5B,aAAd,IAA+B+B,aAAvD;AACD,KAlByC,CAmB1C;;;AACA,SAAKvC,UAAL,GAAmB,KAAKM,YAAL,GAAqB,KAAKC,WAAL,GAAmB,CAAzC,GAA+C,KAAKO,SAAtE;AACA,SAAK0B,QAAL,GAAgB,KAAKrC,WAAL,GAAmB,KAAKI,WAAxB,GAAsC/B,YAAY,CAACM,cAAnE;AACD;;AAED2D,EAAAA,IAAI,GAAI;AAAC;;AACP,QAAG,KAAKvC,QAAR,EAAiB;AACf,WAAKjB,OAAL,CAAayD,IAAb;AACAnE,MAAAA,KAAK,CAACoE,UAAN,CACE,KAAK1D,OADP,EAEE,CAFF,EAEK,KAAKqB,YAFV,EAGE,KAAKO,eAHP,EAGwB,KAAKC,SAH7B,EAIE,KAAKC,WAJP,EAIoB,KAAKG,SAJzB;AAMA,WAAKjC,OAAL,CAAa2D,OAAb;AACD;AACF;;AAEDC,EAAAA,QAAQ,GAAI;AACV,SAAK5D,OAAL,CAAayD,IAAb;AACA,SAAKzD,OAAL,CAAa6D,SAAb,CAAuB,KAAK9C,UAA5B,EAAwC,CAAxC;;AACA,QAAG,KAAKF,EAAL,GAAU,KAAKM,OAAlB,EAA0B;AACxB,WAAKnB,OAAL,CAAa8D,SAAb,GAAyB,MAAzB;AACA,WAAK9D,OAAL,CAAa+D,MAAb,CAAoBzE,KAAK,CAAC0E,EAA1B;AACD,KAHD,MAII;AACF,WAAKhE,OAAL,CAAa8D,SAAb,GAAyB,OAAzB;AACD;;AACD,SAAK9D,OAAL,CAAaiE,IAAb,GAAoB3E,KAAK,CAAC2E,IAAN,CAAW,KAAKV,QAAhB,CAApB;;AACA,QAAG,KAAKd,SAAL,MAAoB,KAAKI,SAAL,EAAvB,EAAyC;AACvC,WAAK7C,OAAL,CAAaiC,SAAb,GAAyB,KAAKC,oBAA9B;AACD,KAFD,MAGK;AACH,WAAKlC,OAAL,CAAaiC,SAAb,GAAyB,KAAKA,SAA9B;AACD;;AACD,SAAKjC,OAAL,CAAakE,QAAb,CACE,KAAKvD,KADP,EACc,CADd,EACiB,KAAK4C,QAAL,GAAgBhE,YAAY,CAACK,sBAD9C;AAEA,SAAKI,OAAL,CAAa2D,OAAb;AACD;;AAEDQ,EAAAA,cAAc,CAAE9B,CAAF,EAAKC,CAAL,EAAQ;AACpB,UAAM8B,IAAI,GAAG9E,KAAK,CAAC+E,WAAN,CAAkB,KAAKxD,EAAvB,EAA2B,KAAKC,EAAhC,EAAoCuB,CAApC,EAAuCC,CAAvC,CAAb;;AACA,QAAI,KAAKrB,QAAL,IAAiBmD,IAAI,GAAG,KAAKzC,UAAjC,EAA6C;AAC3C,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD;;AAhJQ;;AAmJX,SAAS7B,IAAT","sourcesContent":["import * as utils from './PatchbayUtils'\n\nconst portDefaults = {\n  wobbleStep: 0.07,\n  wobbleScaler: 0.1,\n  lineWidthScaler: 0.4,\n  minSizeScaler: 0.25, // percentage\n  fillTextFontSizeScaler: 0.2,\n  fontSizeScaler: 0.4\n};\n\nclass Port {\n  constructor (context, parent, type, id, name, color, getGlobalTouchedPort, getGlobalHoveredPort) {\n    this.context = context;\n    this._parent = parent;\n    this._type = type;\n    this._id = id;\n    this._name = name;\n\n    this.getGlobalTouchedPort = getGlobalTouchedPort;\n    this.getGlobalHoveredPort = getGlobalHoveredPort;\n\n    this.connections = {};\n\n    this._x = 0;\n    this._y = 0;\n    this.textOffset = undefined;\n\n    this._visible = false;\n    this._sizeScaler = 0.0;\n\n    this.parentX = 0;\n    this.parentY = 0;\n    this.parentRadius = undefined;\n    this.parentWidth = undefined;\n\n    this.wobbleCounter = Math.random() * utils.PI2;\n    this.portRadius = undefined;\n    this.drawnPortRadius = undefined;\n    this.lineWidth = undefined;\n\n    this.strokeStyle = utils.colors.background();\n    this.fillStyle = color();\n    this.highlightedFillStyle = utils.colors.white();\n  }\n\n  // GETTERS\n\n  get visible () { return this._visible }\n\n  get x () { return this._x }\n\n  get y () { return this._y }\n\n  get name () { return this._name; }\n\n  get id () { return this._id; }\n\n  get type () { return this._type; }\n\n  get parent () { return this._parent; }\n\n  get radius () { return this.portRadius; }\n\n  get sizeScaler () { return this._sizeScaler; }\n\n  // SETTERS\n\n  set name (name) { this._name = name; }\n\n  isTouched () {\n    return Boolean(this.getGlobalTouchedPort() === this);\n  }\n\n  isPotentialConnection () {\n    const port = this.getGlobalTouchedPort();\n    return Boolean(port && port.type !== this._type);\n  }\n\n  isHovered () {\n    return Boolean(this.getGlobalHoveredPort() === this);\n  }\n\n  adjustToScreenSize (parentRadius, parentWidth, parentX, parentY) {\n    this.parentRadius = parentRadius;\n    this.parentWidth = parentWidth;\n    this.parentX = parentX;\n    this.parentY = parentY;\n  }\n\n  update (sizeScaler, radLocation, isVisible) {\n    // the Port is only visible if 1) told so by parent, and 2) is big enough\n    this._visible = isVisible && sizeScaler > portDefaults.minSizeScaler;\n    this._sizeScaler = !this._visible ? 0 : sizeScaler;\n    // Ports need an absolute coordinate on the screen\n    // because their position is used to determine when they are being\n    // interacted with\n    this._x = this.parentRadius * Math.cos(radLocation) + this.parentX;\n    this._y = this.parentRadius * Math.sin(radLocation) + this.parentY;\n    // drawArc() radius and stroke width\n    this.lineWidth = Math.floor(this.portRadius * portDefaults.lineWidthScaler);\n    this.portRadius = (this.parentWidth / 2) * this._sizeScaler;\n    this.drawnPortRadius = Number(this.portRadius);\n    // wobble the port's radius, if `touchedPort` is from the other circle\n    if(this.isPotentialConnection()) {\n      this.wobbleCounter = (this.wobbleCounter + portDefaults.wobbleStep) % utils.PI2;\n      const wobbleMaxSize = portDefaults.wobbleScaler * this.portRadius;\n      this.drawnPortRadius += Math.sin(this.wobbleCounter) * wobbleMaxSize;\n    }\n    // text settings\n    this.textOffset = (this.parentRadius - (this.parentWidth / 2)) - this.lineWidth;\n    this.fontSize = this._sizeScaler * this.parentWidth * portDefaults.fontSizeScaler;\n  }\n\n  draw () {;\n    if(this._visible){\n      this.context.save();\n      utils.drawCircle(\n        this.context,\n        0, this.parentRadius,\n        this.drawnPortRadius, this.lineWidth,\n        this.strokeStyle, this.fillStyle\n      )\n      this.context.restore();\n    }\n  }\n\n  drawName () {\n    this.context.save();\n    this.context.translate(this.textOffset, 0);\n    if(this._x < this.parentX){\n      this.context.textAlign = 'left';\n      this.context.rotate(utils.PI);\n    }\n    else{\n      this.context.textAlign = 'right';\n    }\n    this.context.font = utils.font(this.fontSize);\n    if(this.isTouched() || this.isHovered()) {\n      this.context.fillStyle = this.highlightedFillStyle;\n    }\n    else {\n      this.context.fillStyle = this.fillStyle;\n    }\n    this.context.fillText(\n      this._name, 0, this.fontSize * portDefaults.fillTextFontSizeScaler);\n    this.context.restore();\n  }\n\n  isUserTouching (x, y) {\n    const dist = utils.getDistance(this._x, this._y, x, y);\n    if (this._visible && dist < this.portRadius) {\n      return true;\n    }\n    return false;\n  }\n}\n\nexport { Port }\n"]},"metadata":{},"sourceType":"module"}