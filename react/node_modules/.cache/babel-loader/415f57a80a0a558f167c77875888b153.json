{"ast":null,"code":"import * as utils from './DrawUtils';\nimport { Port } from './Port';\nconst arcDefaults = {\n  touchingScaler: 0.4,\n  arcWidthScaler: 0.65,\n  gutterLineWidthScaler: 0.45,\n  gutterScaler: 0.012,\n  emptyArcScaler: 0.1,\n  sizeScalerMultiplier: 1.7,\n  sizeScalerThresh: 0.85\n};\n\nclass Arc {\n  constructor(params, parent, type, color, name, id, index) {\n    this.params = params;\n    this._parent = parent;\n    this._type = type;\n    this._color = color;\n    this._name = name;\n    this._id = id;\n    this._index = index;\n    this._ports = [];\n    this._focused = false;\n    this._touched = false;\n    this._isSelected = false;\n    this.start = undefined;\n    this.end = undefined;\n    this.radius = undefined;\n    this.portSize = undefined;\n    this.arcLineWidth = undefined;\n    this.gutterStart = undefined;\n    this.gutterEnd = undefined;\n    this.gutterLineWidth = undefined;\n    this.test = true;\n  } // GETTERS\n\n\n  get isSelected() {\n    return this._isSelected;\n  }\n\n  get parent() {\n    return this._parent;\n  }\n\n  get type() {\n    return this._type;\n  }\n\n  get color() {\n    return this._color;\n  }\n\n  get name() {\n    return this._name;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get index() {\n    return this._index;\n  }\n\n  get ports() {\n    return this._ports;\n  }\n\n  get focused() {\n    return this._focused;\n  }\n\n  get touched() {\n    return this._touched;\n  } // SETTERS\n\n\n  set focused(newVal) {\n    this._focused = newVal;\n  }\n\n  set touched(newVal) {\n    this._touched = newVal;\n  }\n\n  addPort(index) {\n    // a port is simply labelled by it's index\n    const tempPort = new Port(this.params, this, this._type, index);\n    this._ports[index] = tempPort;\n  }\n\n  handleMeta(data) {\n    // all of an Arc's ports are created all at once\n    if (this._ports.length == 0) {\n      const totalNewPorts = Number(data.totalPorts[this._type]);\n\n      for (const i = 0; i < totalNewPorts; i++) {\n        this.addPort(i);\n      }\n    } // if ports already exist, then we are updated the names of the ports\n    else if (this.test) {\n        // loop through all ports of this type (in or out)\n        for (const i in data.ports[this._type]) {\n          const dataPort = data.ports[this._type][i]; // TODO: not sure when this would ever be false...\n\n          if (dataPort) {\n            // loop through all this Arc's previously saved ports\n            for (const p = 0; p < this._ports.length; p++) {\n              if (this._ports[p].index == dataPort.index) {\n                // update the name\n                this._ports[p].name = dataPort.name;\n                break;\n              }\n            }\n          }\n        }\n      }\n  }\n\n  update(start, end, radius, portSize, padding, isSelected) {\n    // update this Arc's visual draw settings\n    this.start = start + padding;\n    this.end = end - padding;\n\n    if (this._parent.type === this.params.outType) {\n      if (this.params.width < this.params.height) {\n        this.start = (this.start + utils.PI * 1.75) % utils.PI2;\n        this.end = (this.end + utils.PI * 1.75) % utils.PI2;\n      } else {\n        this.start = (this.start + utils.PI * .25) % utils.PI2;\n        this.end = (this.end + utils.PI * .25) % utils.PI2;\n      }\n    } else {\n      if (this.params.width < this.params.height) {\n        this.start = (this.start + utils.PI * .75) % utils.PI2;\n        this.end = (this.end + utils.PI * .75) % utils.PI2;\n      } else {\n        this.start = (this.start + utils.PI * 1.25) % utils.PI2;\n        this.end = (this.end + utils.PI * 1.25) % utils.PI2;\n      }\n    }\n\n    if (this.params.height < this.params.width) {\n      this.start = (this.start + utils.PI * 1.5) % utils.PI2;\n      this.end = (this.end + utils.PI * 1.5) % utils.PI2;\n    }\n\n    this.radius = radius;\n    this.portSize = portSize;\n    this._isSelected = isSelected;\n\n    if (this.end < this.start) {\n      this.end += utils.PI2;\n    }\n\n    let widthScaler = arcDefaults.arcWidthScaler; // if this Arc is empy, draw the Arc as a thin line\n\n    if (this._ports.length <= 0) {\n      widthScaler = arcDefaults.emptyArcScaler;\n    }\n\n    this.arcLineWidth = Math.max(this._parent.lineWidth * widthScaler, 1);\n    this.updateGutter();\n    this.updatePorts();\n  }\n\n  updateGutter() {\n    // if it's an Input Arc and is selected, give it an inner grey \"gutter\"\n    this.gutterStart = this.start + utils.PI * arcDefaults.gutterScaler;\n    this.gutterEnd = this.end + utils.PI * arcDefaults.gutterScaler;\n    this.gutterLineWidth = undefined;\n\n    if (this._isSelected) {\n      if (this._parent.type === this.params.inType && this._ports.length > 0) {\n        this.gutterLineWidth = Math.max(this._parent.lineWidth * arcDefaults.gutterLineWidthScaler, 1);\n      }\n    }\n  }\n\n  updatePorts() {\n    // update each Port's visual draw settings\n    this.rotStep = (this.end - this.start) / this._ports.length;\n\n    for (const i = 0; i < this._ports.length; i++) {\n      if (this._ports[i]) {\n        // the visible flag is used by Cords to determine if they should be shown\n        const radLocation = this.start + this.rotStep * i + this.rotStep / 2;\n        const isVisible = Boolean(this._isSelected);\n\n        this._ports[i].update(this.radius, this.portSize, radLocation, isVisible);\n      }\n    }\n  }\n\n  isTouchingPort(x, y, sizeScaler) {\n    // test to see if we are touching one of this Arc's ports\n    // if yes, set that Port as the global `touchedPort`\n    for (const i = 0; i < this._ports.length; i++) {\n      if (this._ports[i]) {\n        const dist = utils.getDistance(this._ports[i].x, this._ports[i].y, x, y);\n\n        if (dist < this._ports[i].size * arcDefaults.touchingScaler * sizeScaler) {\n          this._ports[i].touched = true;\n          this.params.touchedPort = this._ports[i];\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  drawArc() {\n    // save the context's state\n    this.params.context.save();\n    utils.drawArc(this.params.context, 0, 0, this.radius, this.start, this.end, this.arcLineWidth, this._color(), undefined); // draw a grey arc in the middle of the main arc\n\n    if (this.gutterLineWidth) {\n      utils.drawArc(this.params.context, 0, 0, this.radius, this.gutterStart, this.gutterEnd, this.gutterLineWidth, this.params.colors.grey(), undefined);\n    }\n\n    this.params.context.restore();\n  }\n\n  drawName() {\n    this.params.context.save();\n    this.params.context.rotate(this.start + this.rotStep / 2);\n\n    for (const i = 0; i < this._ports.length; i++) {\n      if (this._ports[i]) {\n        this._ports[i].drawName();\n\n        this.params.context.rotate(this.rotStep);\n      }\n    }\n\n    this.params.context.restore();\n  }\n\n  drawPorts(sizeScaler) {\n    // use the `sizeScaler` to dynamically set the radius of the\n    // child Port circles\n    if (sizeScaler < 0) sizeScaler = 0;\n    sizeScaler *= arcDefaults.sizeScalerMultiplier;\n\n    if (sizeScaler > arcDefaults.sizeScalerThresh) {\n      sizeScaler = arcDefaults.sizeScalerThresh;\n    }\n\n    this.sizeScaler = sizeScaler / arcDefaults.sizeScalerThresh; // map [0, 1]\n\n    this.sizeScaler = Math.pow(this.sizeScaler, 2); // give it a curve\n    // draw the child Ports\n\n    this.params.context.save();\n    this.params.context.rotate(this.start + this.rotStep / 2 - utils.PI * 0.5);\n\n    for (const i = 0; i < this._ports.length; i++) {\n      if (this._ports[i]) {\n        this._ports[i].draw(sizeScaler);\n\n        this.params.context.rotate(this.rotStep);\n      }\n    }\n\n    this.params.context.restore();\n  }\n\n}\n\nexport { Arc };","map":{"version":3,"sources":["/Users/andy/Documents/patchbay-react/patchbay-react/src/modules/Arc.js"],"names":["utils","Port","arcDefaults","touchingScaler","arcWidthScaler","gutterLineWidthScaler","gutterScaler","emptyArcScaler","sizeScalerMultiplier","sizeScalerThresh","Arc","constructor","params","parent","type","color","name","id","index","_parent","_type","_color","_name","_id","_index","_ports","_focused","_touched","_isSelected","start","undefined","end","radius","portSize","arcLineWidth","gutterStart","gutterEnd","gutterLineWidth","test","isSelected","ports","focused","touched","newVal","addPort","tempPort","handleMeta","data","length","totalNewPorts","Number","totalPorts","i","dataPort","p","update","padding","outType","width","height","PI","PI2","widthScaler","Math","max","lineWidth","updateGutter","updatePorts","inType","rotStep","radLocation","isVisible","Boolean","isTouchingPort","x","y","sizeScaler","dist","getDistance","size","touchedPort","drawArc","context","save","colors","grey","restore","drawName","rotate","drawPorts","pow","draw"],"mappings":"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","sourcesContent":["import * as utils from './DrawUtils'\nimport { Port } from './Port'\n\nconst arcDefaults = {\n  touchingScaler: 0.4,\n  arcWidthScaler: 0.65,\n  gutterLineWidthScaler: 0.45,\n  gutterScaler: 0.012,\n  emptyArcScaler: 0.1,\n  sizeScalerMultiplier: 1.7,\n  sizeScalerThresh: 0.85\n};\n\nclass Arc {\n  constructor (params, parent, type, color, name, id, index) {\n    this.params = params;\n\n    this._parent = parent;\n    this._type = type;\n    this._color = color;\n    this._name = name;\n    this._id = id;\n    this._index = index;\n\n    this._ports = [];\n\n    this._focused = false;\n    this._touched = false;\n\n    this._isSelected = false;\n\n    this.start = undefined;\n    this.end = undefined;\n    this.radius = undefined;\n    this.portSize = undefined;\n    this.arcLineWidth = undefined;\n\n    this.gutterStart = undefined;\n    this.gutterEnd = undefined;\n    this.gutterLineWidth = undefined;\n\n    this.test = true;\n  }\n\n  // GETTERS\n\n  get isSelected () { return this._isSelected; }\n\n  get parent () { return this._parent; }\n\n  get type () { return this._type; }\n\n  get color () { return this._color; }\n\n  get name () { return this._name; }\n\n  get id () { return this._id; }\n\n  get index () { return this._index; }\n\n  get ports () { return this._ports; }\n\n  get focused () { return this._focused; }\n\n  get touched () { return this._touched; }\n\n  // SETTERS\n\n  set focused (newVal) { this._focused = newVal; }\n\n  set touched (newVal) { this._touched = newVal; }\n\n  addPort (index) {\n    // a port is simply labelled by it's index\n    const tempPort = new Port(this.params, this, this._type, index);\n    this._ports[index] = tempPort;\n  }\n\n  handleMeta (data) {\n    // all of an Arc's ports are created all at once\n    if(this._ports.length==0){\n      const totalNewPorts = Number(data.totalPorts[this._type]);\n      for(const i = 0; i < totalNewPorts; i++){\n        this.addPort(i);\n      }\n    }\n    // if ports already exist, then we are updated the names of the ports\n    else if(this.test){\n      // loop through all ports of this type (in or out)\n      for(const i in data.ports[this._type]){\n        const dataPort = data.ports[this._type][i];\n        // TODO: not sure when this would ever be false...\n        if (dataPort) {\n          // loop through all this Arc's previously saved ports\n          for(const p = 0;p < this._ports.length; p++){\n            if(this._ports[p].index == dataPort.index){\n              // update the name\n              this._ports[p].name = dataPort.name;\n              break;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  update (start, end, radius, portSize, padding, isSelected) {\n    // update this Arc's visual draw settings\n    this.start = start + padding;\n    this.end = end - padding;\n    if(this._parent.type === this.params.outType){\n      if(this.params.width < this.params.height){\n        this.start = (this.start + (utils.PI * 1.75)) % utils.PI2;\n        this.end = (this.end + (utils.PI * 1.75)) % utils.PI2;\n      }\n      else{\n        this.start = (this.start + (utils.PI * .25)) % utils.PI2;\n        this.end = (this.end + (utils.PI * .25)) % utils.PI2;\n      }\n    }\n    else{\n      if(this.params.width < this.params.height){\n        this.start = (this.start + (utils.PI * .75)) % utils.PI2;\n        this.end = (this.end + (utils.PI * .75)) % utils.PI2;\n      }\n      else{\n        this.start = (this.start + (utils.PI * 1.25)) % utils.PI2;\n        this.end = (this.end + (utils.PI * 1.25)) % utils.PI2;\n      }\n    }\n    if(this.params.height < this.params.width){\n      this.start = (this.start + utils.PI * 1.5) % utils.PI2;\n      this.end = (this.end + utils.PI * 1.5) % utils.PI2;\n    }\n    this.radius = radius;\n    this.portSize = portSize;\n    this._isSelected = isSelected;\n    if(this.end < this.start) {\n      this.end += utils.PI2;\n    }\n    let widthScaler = arcDefaults.arcWidthScaler;\n    // if this Arc is empy, draw the Arc as a thin line\n    if(this._ports.length <= 0) {\n      widthScaler = arcDefaults.emptyArcScaler;\n    }\n    this.arcLineWidth = Math.max(this._parent.lineWidth * widthScaler, 1);\n    this.updateGutter();\n    this.updatePorts();\n  }\n\n  updateGutter() {\n    // if it's an Input Arc and is selected, give it an inner grey \"gutter\"\n    this.gutterStart = this.start + (utils.PI * arcDefaults.gutterScaler);\n    this.gutterEnd = this.end + (utils.PI * arcDefaults.gutterScaler);\n    this.gutterLineWidth = undefined;\n    if (this._isSelected) {\n      if (this._parent.type === this.params.inType && this._ports.length > 0) {\n        this.gutterLineWidth = Math.max(\n          this._parent.lineWidth * arcDefaults.gutterLineWidthScaler, 1);\n      }\n    }\n  }\n\n  updatePorts () {\n    // update each Port's visual draw settings\n    this.rotStep = (this.end - this.start) / this._ports.length;\n    for(const i = 0;i < this._ports.length; i++){\n      if(this._ports[i]){\n        // the visible flag is used by Cords to determine if they should be shown\n        const radLocation = this.start + (this.rotStep * i) + (this.rotStep / 2);\n        const isVisible = Boolean(this._isSelected);\n        this._ports[i].update(this.radius, this.portSize, radLocation, isVisible);\n      }\n    }\n  }\n\n  isTouchingPort (x, y, sizeScaler) {\n    // test to see if we are touching one of this Arc's ports\n    // if yes, set that Port as the global `touchedPort`\n    for(const i = 0; i < this._ports.length; i++){\n      if(this._ports[i]){\n        const dist = utils.getDistance(this._ports[i].x, this._ports[i].y, x, y);\n        if(dist < this._ports[i].size * arcDefaults.touchingScaler * sizeScaler){\n          this._ports[i].touched = true;\n          this.params.touchedPort = this._ports[i];\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  drawArc () {\n    // save the context's state\n    this.params.context.save();\n    utils.drawArc(\n      this.params.context,\n      0, 0, this.radius, this.start, this.end,\n      this.arcLineWidth, this._color(), undefined\n    )\n    // draw a grey arc in the middle of the main arc\n    if (this.gutterLineWidth) {\n      utils.drawArc(\n        this.params.context,\n        0, 0, this.radius, this.gutterStart, this.gutterEnd,\n        this.gutterLineWidth, this.params.colors.grey(), undefined\n      )\n    }\n    this.params.context.restore();\n  }\n\n  drawName () {\n    this.params.context.save();\n    this.params.context.rotate(this.start + (this.rotStep / 2));\n    for(const i = 0;i < this._ports.length; i++){\n      if(this._ports[i]){\n        this._ports[i].drawName();\n        this.params.context.rotate(this.rotStep);\n      }\n    }\n    this.params.context.restore();\n  }\n\n  drawPorts (sizeScaler) {\n    // use the `sizeScaler` to dynamically set the radius of the\n    // child Port circles\n    if(sizeScaler < 0) sizeScaler = 0;\n    sizeScaler *= arcDefaults.sizeScalerMultiplier;\n    if(sizeScaler > arcDefaults.sizeScalerThresh) {\n      sizeScaler = arcDefaults.sizeScalerThresh;\n    }\n    this.sizeScaler = sizeScaler / arcDefaults.sizeScalerThresh; // map [0, 1]\n    this.sizeScaler = Math.pow(this.sizeScaler, 2)  // give it a curve\n    // draw the child Ports\n    this.params.context.save();\n    this.params.context.rotate((this.start + (this.rotStep / 2)) - (utils.PI * 0.5));\n    for(const i = 0; i < this._ports.length; i++){\n      if(this._ports[i]){\n        this._ports[i].draw(sizeScaler);\n        this.params.context.rotate(this.rotStep);\n      }\n    }\n    this.params.context.restore();\n  }\n}\n\nexport { Arc }\n"]},"metadata":{},"sourceType":"module"}