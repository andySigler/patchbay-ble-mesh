{"ast":null,"code":"import * as utils from './DrawUtils';\nconst portDefaults = {\n  wobbleStep: 0.07,\n  wobbleAmount: 3,\n  lineWidthScaler: 0.4,\n  minSizeScaler: 0.25,\n  // percentage\n  fillTextFontSizeScaler: 0.2,\n  fontSizeScaler: 0.4,\n  touchingScaler: 1.0\n};\n\nclass Port {\n  constructor(params, parent, color, type, index) {\n    this.params = params;\n    this.context = this.params.context;\n    this._parent = parent;\n    this._type = type;\n    this._index = index;\n    this._name = \"\";\n    this.connections = {};\n    this._x = 0;\n    this._y = 0;\n    this.parentCircleX = 0;\n    this.parentCircleY = 0;\n    this.textOffset = undefined;\n    this._touched = false;\n    this._hovered = false;\n    this.arcRadius = undefined;\n    this.arcLineWidth = undefined;\n    this.wobbleCounter = Math.random() * utils.PI2;\n    this.portRadius = undefined;\n    this.lineWidth = undefined;\n    this.strokeStyle = utils.colors.background();\n    this.fillStyle = color();\n    this.highlightedFillStyle = utils.colors.white(); // the visible flag is used by Cords to determine if they should be shown\n\n    this._visible = false;\n  } // GETTERS\n\n\n  get visible() {\n    return this._visible;\n  }\n\n  get x() {\n    return this._x;\n  }\n\n  get y() {\n    return this._y;\n  }\n\n  get touched() {\n    return this._touched;\n  }\n\n  get hovered() {\n    return this._hovered;\n  }\n\n  get name() {\n    return this._name;\n  }\n\n  get index() {\n    return this._index;\n  }\n\n  get type() {\n    return this._type;\n  }\n\n  get parent() {\n    return this._parent;\n  }\n\n  get size() {\n    return this.portRadius;\n  } // SETTERS\n\n\n  set touched(state) {\n    this._touched = state;\n  }\n\n  set hovered(state) {\n    this._hovered = state;\n  }\n\n  set name(name) {\n    this._name = name;\n  }\n\n  update(sizeScaler, radLocation, isVisible) {\n    // the Port is only visible if 1) told so by parent, and 2) is big enough\n    this._visible = isVisible && sizeScaler > portDefaults.minSizeScaler;\n    sizeScaler = !this._visible ? 0 : utils.clipValue(sizeScaler, portDefaults.minSizeScaler, 1); // Ports need an absolute coordinate on the screen\n    // because their position is used to determine when they are being\n    // interacted with\n\n    this._x = this.arcRadius * Math.cos(radLocation) + this.parentCircleX;\n    this._y = this.arcRadius * Math.sin(radLocation) + this.parentCircleY; // drawArc() radius and stroke width\n\n    this.lineWidth = Math.floor(this.portRadius * portDefaults.lineWidthScaler);\n    this.portRadius = this.arcLineWidth / 2 * sizeScaler; // wobble the port's radius, if `touchedPort` is from the other circle\n\n    this.wobbleCounter = (this.wobbleCounter + portDefaults.wobbleStep) % utils.PI2;\n\n    if (this.params.touchedPort && this.params.touchedPort.type !== this._type) {\n      this.portRadius += Math.sin(this.wobbleCounter) * portDefaults.wobbleAmount;\n    } // text settings\n\n\n    this.textOffset = this.arcRadius - this.arcLineWidth / 2 - this.lineWidth;\n    this.fontSize = sizeScaler * this.arcLineWidth * portDefaults.fontSizeScaler;\n  }\n\n  onScreenUpdate(arcRadius, lineWidth, relX, relY) {\n    this.arcRadius = arcRadius;\n    this.arcLineWidth = lineWidth;\n    this.parentCircleX = relX;\n    this.parentCircleY = relY;\n  }\n\n  draw() {\n    ;\n\n    if (this._visible) {\n      this.context.save();\n      utils.drawArc(this.context, 0, this.arcRadius, this.portRadius, 0, utils.PI2, this.lineWidth, this.strokeStyle, this.fillStyle);\n      this.context.restore();\n    }\n  }\n\n  drawName() {\n    this.context.save();\n    this.context.translate(this.textOffset, 0);\n\n    if (this._x < this.parentCircleX) {\n      this.context.textAlign = 'left';\n      this.context.rotate(utils.PI);\n    } else {\n      this.context.textAlign = 'right';\n    }\n\n    this.context.font = utils.font(this.fontSize);\n\n    if (this._touched || this._hovered) {\n      this.context.fillStyle = this.highlightedFillStyle;\n    } else {\n      this.context.fillStyle = this.fillStyle;\n    }\n\n    this.context.fillText(this._name, 0, this.fontSize * portDefaults.fillTextFontSizeScaler);\n    this.context.restore();\n  }\n\n  isTouching(x, y) {\n    const dist = utils.getDistance(this._x, this._y, x, y);\n\n    if (this._visible && dist < this.portRadius) {\n      return true;\n    }\n\n    return false;\n  }\n\n}\n\nexport { Port };","map":{"version":3,"sources":["/Users/andy/Documents/patchbay-react/patchbay-react/src/modules/Port.js"],"names":["utils","portDefaults","wobbleStep","wobbleAmount","lineWidthScaler","minSizeScaler","fillTextFontSizeScaler","fontSizeScaler","touchingScaler","Port","constructor","params","parent","color","type","index","context","_parent","_type","_index","_name","connections","_x","_y","parentCircleX","parentCircleY","textOffset","undefined","_touched","_hovered","arcRadius","arcLineWidth","wobbleCounter","Math","random","PI2","portRadius","lineWidth","strokeStyle","colors","background","fillStyle","highlightedFillStyle","white","_visible","visible","x","y","touched","hovered","name","size","state","update","sizeScaler","radLocation","isVisible","clipValue","cos","sin","floor","touchedPort","fontSize","onScreenUpdate","relX","relY","draw","save","drawArc","restore","drawName","translate","textAlign","rotate","PI","font","fillText","isTouching","dist","getDistance"],"mappings":"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","sourcesContent":["import * as utils from './DrawUtils'\n\nconst portDefaults = {\n  wobbleStep: 0.07,\n  wobbleAmount: 3,\n  lineWidthScaler: 0.4,\n  minSizeScaler: 0.25, // percentage\n  fillTextFontSizeScaler: 0.2,\n  fontSizeScaler: 0.4,\n  touchingScaler: 1.0\n};\n\nclass Port {\n  constructor (params, parent, color, type, index) {\n    this.params = params;\n    this.context = this.params.context;\n\n    this._parent = parent;\n    this._type = type;\n    this._index = index;\n    this._name = \"\";\n\n    this.connections = {};\n\n    this._x = 0;\n    this._y = 0;\n    this.parentCircleX = 0;\n    this.parentCircleY = 0;\n    this.textOffset = undefined;\n\n    this._touched = false;\n    this._hovered = false;\n\n    this.arcRadius = undefined;\n    this.arcLineWidth = undefined;\n\n    this.wobbleCounter = Math.random() * utils.PI2;\n    this.portRadius = undefined;\n    this.lineWidth = undefined;\n\n    this.strokeStyle = utils.colors.background();\n    this.fillStyle = color();\n    this.highlightedFillStyle = utils.colors.white();\n\n    // the visible flag is used by Cords to determine if they should be shown\n    this._visible = false;\n  }\n\n  // GETTERS\n\n  get visible () { return this._visible }\n\n  get x () { return this._x }\n\n  get y () { return this._y }\n\n  get touched () { return this._touched; }\n\n  get hovered () { return this._hovered; }\n\n  get name () { return this._name; }\n\n  get index () { return this._index; }\n\n  get type () { return this._type; }\n\n  get parent () { return this._parent; }\n\n  get size () { return this.portRadius; }\n\n  // SETTERS\n\n  set touched (state) { this._touched = state; }\n\n  set hovered (state) { this._hovered = state; }\n\n  set name (name) { this._name = name; }\n\n  update (sizeScaler, radLocation, isVisible) {\n    // the Port is only visible if 1) told so by parent, and 2) is big enough\n    this._visible = isVisible && sizeScaler > portDefaults.minSizeScaler;\n    sizeScaler = !this._visible ? 0 : utils.clipValue(\n      sizeScaler, portDefaults.minSizeScaler, 1);\n    // Ports need an absolute coordinate on the screen\n    // because their position is used to determine when they are being\n    // interacted with\n    this._x = this.arcRadius * Math.cos(radLocation) + this.parentCircleX;\n    this._y = this.arcRadius * Math.sin(radLocation) + this.parentCircleY;\n    // drawArc() radius and stroke width\n    this.lineWidth = Math.floor(this.portRadius * portDefaults.lineWidthScaler);\n    this.portRadius = (this.arcLineWidth / 2) * sizeScaler;\n    // wobble the port's radius, if `touchedPort` is from the other circle\n    this.wobbleCounter = (this.wobbleCounter + portDefaults.wobbleStep) % utils.PI2;\n    if(this.params.touchedPort && this.params.touchedPort.type !== this._type) {\n      this.portRadius += (Math.sin(this.wobbleCounter) * portDefaults.wobbleAmount);\n    }\n    // text settings\n    this.textOffset = (this.arcRadius - (this.arcLineWidth / 2)) - this.lineWidth;\n    this.fontSize = sizeScaler * this.arcLineWidth * portDefaults.fontSizeScaler;\n  }\n\n  onScreenUpdate (arcRadius, lineWidth, relX, relY) {\n    this.arcRadius = arcRadius;\n    this.arcLineWidth = lineWidth;\n    this.parentCircleX = relX;\n    this.parentCircleY = relY;\n  }\n\n  draw () {;\n    if(this._visible){\n      this.context.save();\n      utils.drawArc(\n        this.context,\n        0, this.arcRadius,\n        this.portRadius, 0, utils.PI2,\n        this.lineWidth, this.strokeStyle, this.fillStyle\n      )\n      this.context.restore();\n    }\n  }\n\n  drawName () {\n    this.context.save();\n    this.context.translate(this.textOffset, 0);\n    if(this._x < this.parentCircleX){\n      this.context.textAlign = 'left';\n      this.context.rotate(utils.PI);\n    }\n    else{\n      this.context.textAlign = 'right';\n    }\n    this.context.font = utils.font(this.fontSize);\n    if(this._touched || this._hovered) {\n      this.context.fillStyle = this.highlightedFillStyle;\n    }\n    else {\n      this.context.fillStyle = this.fillStyle;\n    }\n    this.context.fillText(\n      this._name, 0, this.fontSize * portDefaults.fillTextFontSizeScaler);\n    this.context.restore();\n  }\n\n  isTouching (x, y) {\n    const dist = utils.getDistance(this._x, this._y, x, y);\n    if (this._visible && dist < this.portRadius) {\n      return true;\n    }\n    return false;\n  }\n}\n\nexport { Port }\n"]},"metadata":{},"sourceType":"module"}