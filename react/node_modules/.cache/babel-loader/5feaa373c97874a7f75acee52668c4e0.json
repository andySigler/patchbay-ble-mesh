{"ast":null,"code":"import * as utils from './DrawUtils';\nconst cordDefaults = {\n  lineWidthPixels: 3,\n  screenSizeScaler: 0.02,\n  wobbleStep: 0.05,\n  wobbleScaler: 0.2,\n  crossSignThicknessScaler: 0.75,\n  crossSignScaler: 0.6\n};\n\nclass Connection {\n  constructor(params, inPort, outPort) {\n    this.params = params;\n    this.name = this.constructor.generateName(inPort, outPort);\n    this.inPort = inPort;\n    this.outPort = outPort;\n    this._selected = false;\n    this.lineWidth = undefined; // the location and size of the delete circle\n\n    this._x = undefined;\n    this._y = undefined;\n    this._radius = undefined; // some variables to keep track of the sinusoidal pulsing\n    // when hovered for deletion\n\n    this.wobbleCounter = Math.random() * utils.PI2;\n    this.wobbledRadius = undefined;\n    this.crossSignThickness = undefined;\n    this.crossSignRadius = undefined; // colors\n\n    this.lineFill = undefined;\n    this.lineStroke = undefined;\n    this.delCircleFill = undefined;\n    this.delCircleStroke = undefined;\n  }\n\n  static generateName(inPort, outPort) {\n    // \"outArcID/inArcID_inPortID/outPortID\"\n    const inID = inPort.parent.id;\n    const inIndex = inPort.index;\n    const outID = outPort.parent.id;\n    const outIndex = outPort.index;\n    return String(inID + '/' + inIndex + '_' + outID + '/' + outIndex);\n  } // GETTERS\n\n\n  get selected() {\n    return this._selected;\n  }\n\n  get x() {\n    return this._x;\n  }\n\n  get y() {\n    return this._y;\n  }\n\n  get visible() {\n    return this.inPort.visible && this.outPort.visible;\n  }\n\n  get sizeScaler() {\n    return Math.min(this.inPort.sizeScaler, this.outPort.sizeScaler);\n  } // SETTERS\n\n\n  set selected(newVal) {\n    this._selected = newVal;\n  }\n\n  onScreenUpdate() {\n    this._radius = this.params.screenSize * cordDefaults.screenSizeScaler;\n  }\n\n  update() {\n    this.onScreenUpdate();\n\n    if (this.visible) {\n      // the coordinate where a deletion circle would be\n      // will be halfway between the two ports\n      this._x = (this.outPort.x - this.inPort.x) / 2 + this.inPort.x;\n      this._y = (this.outPort.y - this.inPort.y) / 2 + this.inPort.y;\n      this.lineWidth = cordDefaults.lineWidthPixels * this.sizeScaler; // colors\n\n      this.lineFill = utils.colors.white(this.sizeScaler);\n      this.lineStroke = utils.colors.white(this.sizeScaler);\n\n      if (this._selected) {\n        this.wobbleCounter = (this.wobbleCounter + cordDefaults.wobbleStep) % utils.PI2;\n\n        const wobbleRadiusAdder = Math.sin(this.wobbleCounter) * cordDefaults.wobbleScaler * this._radius;\n\n        const wobbledRadius = this._radius + wobbleRadiusAdder;\n        this.wobbledRadius = wobbledRadius * this.sizeScaler;\n        this.crossSignRadius = this.wobbledRadius * cordDefaults.crossSignScaler;\n        this.crossSignThickness = this.lineWidth * cordDefaults.crossSignThicknessScaler; // colors\n\n        this.lineStroke = utils.colors.red(this.sizeScaler);\n        this.delCircleFill = utils.colors.white(this.sizeScaler);\n        this.delCircleStroke = utils.colors.red(this.sizeScaler);\n      }\n    }\n  }\n\n  draw() {\n    if (this.visible) {\n      this.params.context.save();\n      utils.drawLine(this.params.context, this.outPort.x, this.outPort.y, this.inPort.x, this.inPort.y, this.lineWidth, this.lineStroke); // draw the two circles on top of that line, inside each port\n      // these make the edges of the line look a bit nicer\n\n      utils.drawCircle(this.params.context, this.outPort.x, this.outPort.y, this.lineWidth, 0, // use the line's width for a radius\n      undefined, this.lineFill);\n      utils.drawCircle(this.params.context, this.inPort.x, this.inPort.y, this.lineWidth, 0, // use the line's width for a radius\n      undefined, this.lineFill);\n      this.params.context.restore();\n\n      if (this._selected) {\n        this.drawDeleteCircle();\n      }\n    }\n  }\n\n  drawDeleteCircle() {\n    this.params.context.save();\n    this.params.context.translate(this._x, this._y); // draw the circle, with a fill and a stroke\n\n    utils.drawArc(this.params.context, 0, 0, this.wobbledRadius, 0, utils.PI2, this.lineWidth, this.delCircleStroke, this.delCircleFill); // draw the two lines that make the X\n\n    this.params.context.rotate(utils.PI / 4);\n    utils.drawLine(this.params.context, 0, this.crossSignRadius, 0, -this.crossSignRadius, this.crossSignThickness, this.delCircleStroke);\n    this.params.context.rotate(-utils.PI / 2);\n    utils.drawLine(this.params.context, 0, this.crossSignRadius, 0, -this.crossSignRadius, this.crossSignThickness, this.delCircleStroke); // restore the context's state\n\n    this.params.context.restore();\n  }\n\n  isUserTouching(x, y) {\n    if (!this._selected) {\n      return false;\n    }\n\n    const dist = utils.getDistance(x, y, this._x, this._y);\n\n    if (dist < this._radius) {\n      return true;\n    }\n\n    return false;\n  }\n\n}\n\nexport { Connection };","map":{"version":3,"sources":["/Users/andy/Documents/patchbay-react/patchbay-react/src/modules/Connection.js"],"names":["utils","cordDefaults","lineWidthPixels","screenSizeScaler","wobbleStep","wobbleScaler","crossSignThicknessScaler","crossSignScaler","Connection","constructor","params","inPort","outPort","name","generateName","_selected","lineWidth","undefined","_x","_y","_radius","wobbleCounter","Math","random","PI2","wobbledRadius","crossSignThickness","crossSignRadius","lineFill","lineStroke","delCircleFill","delCircleStroke","inID","parent","id","inIndex","index","outID","outIndex","String","selected","x","y","visible","sizeScaler","min","newVal","onScreenUpdate","screenSize","update","colors","white","wobbleRadiusAdder","sin","red","draw","context","save","drawLine","drawCircle","restore","drawDeleteCircle","translate","drawArc","rotate","PI","isUserTouching","dist","getDistance"],"mappings":"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","sourcesContent":["import * as utils from './DrawUtils'\n\nconst cordDefaults = {\n  lineWidthPixels: 3,\n  screenSizeScaler: 0.02,\n  wobbleStep: 0.05,\n  wobbleScaler: 0.2,\n  crossSignThicknessScaler: 0.75,\n  crossSignScaler: 0.6\n};\n\nclass Connection {\n  constructor (params, inPort, outPort) {\n    this.params = params;\n    this.name = this.constructor.generateName(inPort, outPort);\n\n    this.inPort = inPort;\n    this.outPort = outPort;\n\n    this._selected = false;\n\n    this.lineWidth = undefined;\n\n    // the location and size of the delete circle\n    this._x = undefined;\n    this._y = undefined;\n    this._radius = undefined;\n\n    // some variables to keep track of the sinusoidal pulsing\n    // when hovered for deletion\n    this.wobbleCounter = Math.random() * utils.PI2;\n    this.wobbledRadius = undefined;\n    this.crossSignThickness = undefined;\n    this.crossSignRadius = undefined;\n\n    // colors\n    this.lineFill = undefined;\n    this.lineStroke = undefined;\n    this.delCircleFill = undefined;\n    this.delCircleStroke = undefined;\n  }\n\n  static generateName(inPort, outPort) {\n    // \"outArcID/inArcID_inPortID/outPortID\"\n    const inID = inPort.parent.id;\n    const inIndex = inPort.index;\n    const outID = outPort.parent.id;\n    const outIndex = outPort.index;\n    return String(\n      inID + '/' + inIndex + '_' + outID + '/' + outIndex);\n  }\n\n  // GETTERS\n\n  get selected () { return this._selected }\n\n  get x () { return this._x }\n\n  get y () { return this._y }\n\n  get visible () { return this.inPort.visible && this.outPort.visible; }\n\n  get sizeScaler () {\n    return Math.min(this.inPort.sizeScaler, this.outPort.sizeScaler);\n  }\n\n  // SETTERS\n\n  set selected (newVal) { this._selected = newVal; }\n\n  onScreenUpdate () {\n    this._radius = this.params.screenSize * cordDefaults.screenSizeScaler;\n  }\n\n  update () {\n    this.onScreenUpdate();\n\n    if (this.visible) {\n      // the coordinate where a deletion circle would be\n      // will be halfway between the two ports\n      this._x = ((this.outPort.x - this.inPort.x) / 2) + this.inPort.x;\n      this._y = ((this.outPort.y - this.inPort.y) / 2) + this.inPort.y;\n\n      this.lineWidth = cordDefaults.lineWidthPixels * this.sizeScaler;\n\n      // colors\n      this.lineFill = utils.colors.white(this.sizeScaler);\n      this.lineStroke = utils.colors.white(this.sizeScaler);\n\n      if (this._selected) {\n        this.wobbleCounter = (this.wobbleCounter + cordDefaults.wobbleStep) % utils.PI2;\n        const wobbleRadiusAdder = Math.sin(this.wobbleCounter) * cordDefaults.wobbleScaler * this._radius;\n        const wobbledRadius = this._radius + wobbleRadiusAdder;\n        this.wobbledRadius = wobbledRadius * this.sizeScaler;\n        this.crossSignRadius = this.wobbledRadius * cordDefaults.crossSignScaler;\n        this.crossSignThickness = this.lineWidth * cordDefaults.crossSignThicknessScaler;\n        // colors\n        this.lineStroke = utils.colors.red(this.sizeScaler);\n        this.delCircleFill = utils.colors.white(this.sizeScaler);\n        this.delCircleStroke = utils.colors.red(this.sizeScaler);\n      }\n    }\n  }\n\n  draw () {\n    if(this.visible){\n      this.params.context.save();\n      utils.drawLine(\n        this.params.context,\n        this.outPort.x, this.outPort.y, this.inPort.x, this.inPort.y,\n        this.lineWidth, this.lineStroke\n      );\n      // draw the two circles on top of that line, inside each port\n      // these make the edges of the line look a bit nicer\n      utils.drawCircle(\n        this.params.context,\n        this.outPort.x, this.outPort.y,\n        this.lineWidth, 0, // use the line's width for a radius\n        undefined, this.lineFill\n      )\n      utils.drawCircle(\n        this.params.context,\n        this.inPort.x, this.inPort.y,\n        this.lineWidth, 0, // use the line's width for a radius\n        undefined, this.lineFill\n      )\n      this.params.context.restore();\n      if(this._selected){\n        this.drawDeleteCircle();\n      }\n    }\n  }\n\n  drawDeleteCircle () {\n    this.params.context.save();\n    this.params.context.translate(this._x, this._y);\n    // draw the circle, with a fill and a stroke\n    utils.drawArc(\n      this.params.context,\n      0, 0,\n      this.wobbledRadius, 0, utils.PI2,\n      this.lineWidth, this.delCircleStroke, this.delCircleFill\n    )\n    // draw the two lines that make the X\n    this.params.context.rotate(utils.PI / 4);\n    utils.drawLine(\n      this.params.context,\n      0, this.crossSignRadius, 0, -this.crossSignRadius,\n      this.crossSignThickness, this.delCircleStroke\n    );\n    this.params.context.rotate(-utils.PI / 2);\n    utils.drawLine(\n      this.params.context,\n      0, this.crossSignRadius, 0, -this.crossSignRadius,\n      this.crossSignThickness, this.delCircleStroke\n    );\n    // restore the context's state\n    this.params.context.restore();\n  }\n\n  isUserTouching (x, y) {\n    if (!this._selected) {\n      return false;\n    }\n    const dist = utils.getDistance(x, y, this._x, this._y);\n    if (dist < this._radius) {\n      return true;\n    }\n    return false;\n  }\n}\n\nexport { Connection }\n"]},"metadata":{},"sourceType":"module"}